<%- include('partials/header') %>

<div class="page-header">
  <h2>Dashboard</h2>
</div>

<div class="stats-grid">
  <div class="stat-card blue">
    <h3>Total Leads</h3>
    <div class="value"><%= totalLeads %></div>
  </div>
  <div class="stat-card green">
    <h3>Today's Leads</h3>
    <div class="value"><%= todayLeads %></div>
  </div>
  <div class="stat-card orange">
    <h3>This Week</h3>
    <div class="value"><%= weekLeads %></div>
  </div>
  <div class="stat-card purple">
    <h3>Categories</h3>
    <div class="value"><%= totalCategories %></div>
  </div>
</div>

<div class="grid-2">
  <div class="card">
    <div class="card-header">
      <span class="card-title">Lead Status Overview</span>
    </div>
    <table>
      <thead>
        <tr>
          <th>Status</th>
          <th>Count</th>
        </tr>
      </thead>
      <tbody>
        <% statusStats.forEach(stat => { %>
        <tr>
          <td><span class="badge badge-<%= stat._id %>"><%= stat._id %></span></td>
          <td><%= stat.count %></td>
        </tr>
        <% }) %>
      </tbody>
    </table>
  </div>

  <div class="card">
    <div class="card-header">
      <span class="card-title">Recent Extraction Jobs</span>
      <a href="/admin/extraction" class="btn btn-primary btn-sm">View All</a>
    </div>
    <table>
      <thead>
        <tr>
          <th>Category</th>
          <th>Status</th>
          <th>Extracted</th>
        </tr>
      </thead>
      <tbody>
        <% recentJobs.forEach(job => { %>
        <tr>
          <td><%= job.category ? job.category.name : 'N/A' %></td>
          <td><span class="badge badge-<%= job.status %>"><%= job.status %></span></td>
          <td><%= job.totalExtracted %></td>
        </tr>
        <% }) %>
        <% if (recentJobs.length === 0) { %>
        <tr><td colspan="3" class="text-muted text-sm">No extraction jobs yet</td></tr>
        <% } %>
      </tbody>
    </table>
  </div>
</div>

<div class="card">
  <div class="card-header">
    <span class="card-title">Recent Leads</span>
    <a href="/admin/leads" class="btn btn-primary btn-sm">View All</a>
  </div>
  <table>
    <thead>
      <tr>
        <th>Username</th>
        <th>Category</th>
        <th>Status</th>
        <th>Extracted</th>
      </tr>
    </thead>
    <tbody>
      <% recentLeads.forEach(lead => { %>
      <tr>
        <td>@<%= lead.username %></td>
        <td><%= lead.category ? lead.category.name : 'N/A' %></td>
        <td><span class="badge badge-<%= lead.status %>"><%= lead.status %></span></td>
        <td class="text-sm text-muted"><%= new Date(lead.extractedAt).toLocaleDateString() %></td>
      </tr>
      <% }) %>
      <% if (recentLeads.length === 0) { %>
      <tr><td colspan="4" class="text-muted text-sm">No leads yet</td></tr>
      <% } %>
    </tbody>
  </table>
</div>

<%- include('partials/footer') %>
